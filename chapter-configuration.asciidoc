[[confignx]]
== Configuring Nexus

[[configuration-introduction]]
=== Introduction

This chapter covers all aspects of configuring Nexus with the sections
and menu items of the 'Administration' main menu. It can be accessed
by authorized users by pressing the 'Administration' button
image:figs/web/ui-admin-button-icon.png[scale=50] in the main toolbar.

Many of the features shown in this section are only available to administrative users and are available in {oss}. Some
features are only available in {pro} or {proplus}. The 'Administration' menu contains the following sections:

////

TBD add link to all the items below once they are documented

////

'Repository':: The 'Repository' section allows you to manage all
'Repositories' and related configurations such as 'Routing' and
'Targets'.

'Staging' ({pro} and {proplus} only):: The 'Staging' menu section can be used to configure 'Profiles' and 'Rules' used
in the Nexus staging suite.

'CLM' ({proplus} only):: Allows you to configure the integration of Nexus with Nexus Lifecycle.

'Security':: This section provides access to all the configuration
features related to authentication and authorization of users
including 'Privileges', 'Roles', 'Users', but also 'LDAP', 'Atlassian
Crowd', 'SSL Certificates' and 'User Token'.

'Support':: Access a number of features that allow you to administer
and monitor your Nexus server successfully like 'Logging' and 'System
Information'.

'System':: The <<system, general configuration of Nexus>> for
getting started and running Nexus with e.g., <<admin-system-http,
'HTTP'>> or <<admin-system-emailserver,'Email Server'>> settings, but also
<<admin-system-capabilities,'Capabilities'>> and
<<admin-system-tasks,'Tasks'>> to run regularly and other configurations.

////

[[getting-started]]
=== Getting Started

tbd ... write about what to do when first getting going, some system
config and some repo config probably, take from other section in book
and training.. 

this should link to the various sections
////


[[system]]
=== System Configuration

The 'System' section of the 'Administration' menu gives you access to
a number of configuration features for Nexus that you typically need
to configure, after successful installation of Nexus. The following
sections detail:

* Access information about used <<admin-system-bundles,Bundles>>
* Advanced configuration of Nexus with <<admin-system-capabilities,Capabilities>>
* <<admin-system-emailserver,Email/SMTP server configuration>>
* <<admin-system-http,HTTP/HTTPS proxy server configuration>>
* Configuration and management of automated maintenance <<admin-system-tasks,Tasks>>

[[admin-system-bundles]]
==== Bundles
{in} {oss}, {pro}, {proplus}

The Nexus application runs on the OSGi container
http://felix.apache.org/[Apache Felix]. All features and plugins are
managed by the container and are implemented as OSGi bundles.

The 'Bundles' feature view is available in the 'System' section of the
'Administration' main menu. It allows you to inspect a list of all the
OSGi bundles that are deployed as part of the Nexus application and
access detailed information about each bundle.

TIP: Find out more about OSGi and OSGi bundles on the
http://www.osgi.org/[website of the OSGi Alliance].  

[[admin-system-capabilities]]
==== Accessing and Configuring Capabilities
{in} {oss}, {pro}, {proplus}

Capabilities are features of Nexus and Nexus plugins that can be
configured by a user in a generic administration feature view
accessible in the 'System' section of the 'Administration' main menu
via 'Capabilities'.

{nexus} ships with a number of capabilities preinstalled
and allows you to enable/disable them. An example capability is
'Outreach: Management' displayed in <<fig-capability-outreach>>. 

[[fig-capability-outreach]]
.Outreach: Management Capability Settings
image::figs/web/capability-outreach.png[scale=60]

The list of capabilities can be filtered with the search input box in
the header of the list and sorted by the different columns by pressing
a column header. The list uses the following columns:

State:: The state column does not have a title. Enabled capabilities
have a green checkmark added on top of a blue icon. Disabled
capabilities use a greyed out icon.

Type:: The 'Type' column provides the specific type of a capability in
the list.

Category:: The 'Category' is optional and details the wider context
the capability belongs to.

Description:: The 'Description' column contains further descriptive
information about the capability.

Notes:: The 'Notes' column can contain user created text about the
capability.

Every capability can be inspected and configured by selecting it in
the list. The resulting view display the 'Summary' view of the
specific capability. This view includes the display of 'Type', 'State'
and optionally 'Category' and 'Description' in the 'Summary' section
as well as further information in the 'Status', 'About' and 'Notes'
sections.  The 'Status' section displays a text message that details
the status of the capability and any potential problems with the
configuration.  Depending on the capability, the reasons can vary
widely.  The 'About' section displays a descriptive text about the
purpose of the capability.  The 'Notes' field can be used to provide a
descriptive text about the capability or any other notes related to it
and can be persisted by pressing the 'Save' button.

The 'Delete' button below the title allows you to remove a capability and
it's configuration entirely. The 'Enable' and 'Disable' buttons on the
other hand can be used to switch the state of the capability.

The 'Settings' view allows you to activate or deactivate the
capability with the 'Enable this capability' checkbox. Below this
checkbox, each capability type has specific additional configuration
parameters available. Once you have completed the configuration, press
the 'Save' button.

The capabilities management feature view supports adding new
capabilities by pressing the 'Create capability' button above the list
and selecting the desired capability 'Type' from the list. The next
view allows you to perform any capability-specific configuration and
finish the process by pressing the 'Create capability' button below
the parameters.

Many of the built-in capabilities and plugins can be configured in the
'Capabilities' administration section but also in other more user
friendly, targeted user interface sections, e.g., the user token
feature of {pro} can be administrated by using the interface available
via the 'User Token' menu item in the 'Security' section of the
'Administration' menu as well as by editing the user token
capability. Other capabilities are internal to Nexus functionality and
sometimes managed automatically by the responsible plugin. Some
optional configuration like the branding plugin or advanced features
of the smart proxy configuration are only done in the capabilities
administration.

Usage of specific capabilities to achieve a variety of tasks is
detailed in parts of the documentation.

////
tbd  ... add links to all sections maybe.. 

The branding
plugin allows the customization of the icon in the top left-hand
corner of the user interface header and is described in
<<nexus-branding>>.
////

WARNING: In many cases you will not need to configure anything in
'Capabilities' unless explicitly instructed to do so by the Sonatype
support team. Execute any capability changes with caution, potentially
backing up your configuration before proceeding.

[[admin-system-emailserver]]
==== Email Server
{in} {oss}, {pro}, {proplus}

Nexus sends email to users who need to recover user names and
passwords, notifications for staging and a number of other uses. In
order for these notifications to work, configure the SMTP server
settings in the 'Email Server' configuration available via the
'System' section of the 'Administration' menu and displayed in
<<fig-config-administration-smtp>>.

[[fig-config-administration-smtp]]
.Administration SMTP Settings
image::figs/web/config-administration-smtp.png[scale=60]

The 'System email address' parameter defines the email address used in
the +From:+ header of any email sent by Nexus. Typically, this would
be configured as a "Do-Not-Reply" email address or a mailbox or
mailing list monitored by the administrators of the Nexus server.

You can configure the 'Hostname' and 'SMTP server port' of the SMTP
server to use as well as 'Username' and 'SMTP Password'. The 'SMTP
server type' configuration allows you to configure Nexus to to use
'Plain SMTP' or 'Secure SMTP via SSL' to connect to the server or to
use 'Secure SMTP via TLS', which is also known as 'STARTTLS' for the
connection. It upgrades the initially established, plain connection to
be encrypted. In all cases you will need to ensure that the correct
port is used and configured in 'SMTP server port'.

Once you have configured the parameters you can use the 'Verify SMTP
connection' button to confirm the configured parameters and the
successful connection to the server. You will be asked to provide an
email address that should receive a test email message. Successful
sending will be confirmed in another pop up message.

////
tbd document baseUrl somewhere else
[[admin-system-general]]
==== General Server Settings
{in} {oss}, {pro}, {proplus}

The 'General' server configuration is available via the
'System' section of the 'Administration' menu and displayed in
<<fig-admin-system-general>>.

You can change the 'Base URL' for your Nexus installation, which is
used when generating links in emails and RSS feeds. For example, the
Nexus instance for Sonatype development is available at
http://respository.sonatype.org, and it makes use of this 'Base URL'
field to ensure that links in emails and RSS feeds point to the
correct URL. Internally Nexus is running on a different port and
context than the public port 80 and root context.

[[fig-admin-system-general]]
.Configuration of General Server Settings
image::figs/web/admin-system-general.png[scale=50]

TIP: This configuration is especially important if Nexus is proxied by
an external proxy server using a different protocol like HTTPS rather
than plain HTTP known to Nexus or a different hostname like
repository.somecompany.com instead of an IP number only.
////

[[admin-system-http]]
==== HTTP and HTTPS Request and Proxy Settings
{in} {oss}, {pro}, {proplus}

Nexus uses HTTP requests to fetch content from remote servers. In some
cases a customization of these requests is required. Many
organizations use proxy servers for any outbound HTTP network traffic
and the connection to these proxy serves from Nexus needs to be
configured to allow Nexus to reach remote repositories. All this can
be configured in the 'HTTP' configuration available via the 'System'
section of the 'Administration' menu and displayed in
<<fig-admin-system-http>>.

[[fig-admin-system-http]]
.Configuring HTTP Request Settings
image::figs/web/admin-system-http.png[scale=50]

The HTTP configuration in 'User-agent customization' allows you to
append a string to the +User-Agent+ HTTP header field. This can be a
required customization by your proxy servers.

The 'URL parameters' field can be used to add extra parameters to the
URL of all +GET+ requests sent by Nexus to remote repositories. You
can e.g., use this to add identifying information to requests.

The amount of time Nexus will wait for a request to succeed when
interacting with an external, remote repository can be configured with
the 'Timeout' and 'Retry attempts' settings.

If your Nexus instance needs to reach public repositories like the
Central Repository via a proxy server, you can configure the
connection to a proxy server for HTTP and a potentially a different
for HTTPS connection. If you do not configure a proxy for HTTPS, the
HTTP proxy server settings will be used. To configure a HTTP proxy,
select the checkbox beside 'HTTP Proxy' and configure the parameters
in the sections displayed in <<fig-admin-system-http-proxy>>.

TIP: This is a critical initial step for many Enterprise deployments
of Nexus deployment, since these environments are typically secured
via a HTTP/HTTPS proxy server for all outgoing internet traffic.

[[fig-admin-system-http-proxy]]
.Configuring HTTP Proxy Settings
image::figs/web/admin-system-http-proxy.png[scale=50]

You can specify the 'Host' and 'Port' of the HTTP or HTTPS proxy
server and, optionally, the authentication details for 'Username' and
'Password'. If a Windows NT LAN Manager is used to authenticate with
the proxy server you can configure the needed connections details in
'NT LAN Host' and 'NT LAN Manager Domain'.

In addition, you can configure a number of hosts that can be reached
directly and do not need to go through the proxy in the 'Non Proxy
Hosts' setting. <<fig-admin-system-http-proxy>> shows the 'HTTP Proxy'
administration interface. The HTTPS configuration interface looks the
same and is found below the HTTP configuration.

[[admin-system-tasks]]
==== Configuring and Executing Tasks
{in} {oss}, {pro}, {proplus}

Nexus allows you to schedule the execution of maintenance tasks. The
tasks can carry out regular maintenance steps that will be applied to
all repositories or to specific repositories on a configurable
schedule or simply perform other system maintenance. Use the 'Tasks'
menu item in the 'System' section of the 'Administration' menu to
access the feature view, shown in <<fig-repomap-scheduled>>, that
allows you to manage your 'Tasks'.

[[fig-repomap-scheduled]]
.Managing Tasks
image::figs/web/tasks.png[scale=50]

The list interface allows you to add new tasks with the 'Create task'
button as well as inspect and work with the configured tasks. The list
shows the following columns:

Name:: A user-defined name for the task to identify it in the user interface and
log files.

Type:: The type of action the scheduled task executes. The list of
available task types is documented in more detail below.

Status:: Tasks can either be 'Waiting' for their next run, currently
'Running' or 'Disabled'.

Schedule:: The 'Schedule' column shows the 'Task frequency' e.g.,
'Daily', 'Monthly', 'Manual' and others.

Next run:: This column displays date and time of the next execution of
the task based on the configured schedule.

Last run and Last result:: These columns display the date and time as
well as the result and duration of the last execution of the specific task.


When creating or updating a scheduled task, you can configure the
following additional properties:

Task enabled:: Enable or disable a specific task with the checkbox.

Notification Email:: Configure a notification email for task execution
failures. If a scheduled task fails a notification email containing
the task identifier and name as well as the stack trace of the failure
will be sent to the configured email recipient. 

Task frequency:: Selecting the task frequency allows you to configure
the schedule for the task executions. Available choices are 'Manual',
'Once', 'Hourly', 'Daily', 'Weekly', 'Monthly' and 'Advanced (provide
a CRON expression)'. Apart from 'manual', all choices trigger display
of a custom user interface for scheduling the specific
recurrence. Weekly scheduling requires at least one day of the week to
be selected. The advanced setting allows you to provide a CRON
expression to configure more complex schedules. The 'Start time'
allows you to configure a specific date on time from when the schedule
should be started.

Task-type specific configuration is displayed below the notification
email input and differs for each scheduled task.

The following task types are available to perform specific maintenance:

Purge Unused Components and Assets:: This task can be used to remove components and assets in Docker proxy
repositories. Any component that has not been requested in a configured amount of days, will be purged.

Rebuild Maven Repository Metadata:: This task rebuilds the maven-metadata.xml files with the correct information and
will also validate the checksums (.md5/.sha1) for all files in the specified maven2, hosted repository. The 'Group Id',
'Artifact Id' and 'Base Version' parameters allow you to narrow down the section of the repository that will be
repaired. Typically this task is run manually to repair a corrupted repository.

Rebuild Repository Index:: With support for hosted and proxy repositories, this task can rebuild the index. It inspects
actual components and assets found in the repository and rebuilds the index to reflect the true content for supporting
search and browse actions.

////
Backup All Nexus Configuration Files:: This scheduled task will
archive the contents of the +sonatype-work/nexus/conf+ directory.
Once a backup has been run, the contents of the backup will be
available in +sonatype-work/nexus/backup+ in a series of ZIP archives
that use a datetimestamp in the filename. This task is a feature of
Nexus Pro.

Download Indexes:: This scheduled task will cause Nexus to download
indexes from remote repositories for proxied repositories. The
Download Remote Indexes configuration also needs to be enabled on the
proxy repository.

Download NuGet Feed:: This task allows you to download the feed for a
NuGet proxy repository. For one-time invocation, you can enable the
'Clear feed cache?' setting, which will delete the cache completely and
re-fetch all data. The setting 'Fetch all versions?' will trigger the
download of all versions of an component in contrast to the default
behavior of getting only the latest version.

Drop Inactive Staging Repositories:: Staging repositories can be
dropped by user interaction or automated systems using the Nexus
Staging Maven Plugin or Ant Task or a REST API call. Heavy users of
the Nexus staging features observe that some staging and build
promotion repositories are in-evidently left behind. This scheduled
task can be used to drop all these repositories.  You can configure
the duration of inactivity to include the days after the repositories
are dropped as well as the status of the repositories. Any change of
the staging repository like a state change from open to closed to
promoted or released as well other changes to the repository meta data
like a description update are counted as an activity. You can
configure to 'Scan open repositories', 'Scan closed repositories',
'Scan promoted repositories' and 'Scan released repositories' for
inactivity and therefore potentially drop them with this task. This
will allow you to avoid accumulating a large number of stale staging
repositories.

Empty Trash:: The Evict and Purge actions do not delete data from the
Nexus working directory. They simply move data to be cleared or
evicted to a trash directory under the Nexus work directory. This
task deletes the data in this trash directory older than the number of
days specified in the task setting 'Purge Items older than (days)'.

Evict Unused Proxied Items From Repository Caches:: This scheduled
task tells Nexus to delete all proxied items that haven't been "used"
(referenced or retrieved by a client) in a number of days as specified
in Evict Items older than (days). This can be a good job to run if you
are trying to conserve storage space and do not need all of the
components in the future e.g., to reproduce old builds without renewed
retrieval. This is particularly useful for a personal Nexus deployment
with a large change rate of components combined with limited disk space.

Expire Repository Caches:: Repositories have several caches to improve
performance. This task expires the caches causing Nexus to recheck the
remote repository for a proxy repository or the file system for a
hosted repository. You can configure the repository or group to be
affected with the task setting Repository/Group. Alternatively you can
provide a Repository Path to configure the content that should be
expired.

Mirror Eclipse Update Site:: The P2 plugin
allows you to mirror Eclipse update sites. This task can be used to
force updates of repositories that went out of sync.

Optimize Repository Index:: To speed up searches in Nexus, this task
tells the internal search engine to optimize its index files. This has
no affect on the indexes published by Nexus. Typically, this task does
not have to run more than once a week.

Publish Indexes:: Just as Maven downloads an index from a remote
repository, Nexus can publish an index in the same format. This will
make it easier for people using m2eclipse or Nexus to interact with
your repositories.
 
Purge Orphaned API Keys:: This scheduled tasks will delete old, unused
API keys generated and used by various plugins. For example, it should
be scheduled when using the User Token feature or NuGet
repositories. It will purge orphaned API keys e.g., after users reset
their token and should be scheduled to run regularly, specifically
when internal security policies for password resets and you are using
an external security provider like LDAP with this requirement for
resets to access Nexus.

Purge Timeline:: Nexus maintains data that relates to the interaction
between itself, proxied remote repositories, and clients on Nexus.
While this information can be important for purposes of auditing, it
can also take up storage space. Using this task you can tell Nexus to
periodically purge this information. The setting 'Purge Items older
than (days)' controls the age of the data to be deleted.
 
Rebuild NuGet Feed:: If you are using NuGet, pushing your components
into a NuGet hosted repository and are proxying that repository to
other users, this task can be used to rebuild the feed.
 
Rebuild P2 metadata and Rebuild P2 repository:: These tasks can be
used to rebuild the metadata or the full repository with a P2
format. You can specify a Repository/Group or a Repository Path to
determine which content to affect.
 
Remove Releases From Repository:: In many use cases of a repository
manager, it is necessary to keep release components for long periods
of time or forever. This can be necessary for reproducibility reasons,
in order to ensure users have access to old versions or even just for
audit or legal reasons. However, in other use cases, there is no value
in keeping old release components. One example would be a when using a
continuous delivery approach onto a single deployment platform with no
roll back support. In other cases, it could also be impractical due to
the mere number and size of the release components.
+ 
This scheduled task allows you to trigger the deletion of release
components, supporting these use cases taking care of meta data
updates, and removing the need to manually delete the components or use
an external system to trigger the deletion.
+ 
To configure the task, you specify the repository where release
components are to be deleted as well as the number of component
versions to keep for a specific groupId and artifactId coordinate. The
task generates a list of all versions of a component for each groupId
and artifactId coordinate combination and sorts it according to the
version number. The ordering is derived by parsing the version string
and supports http://semver.org[semantic versioning] with additional
semantics for specific classifiers. Further details can be
found in the documentation for the implementing class
http://sonatype.github.io/sonatype-aether/apidocs/org/sonatype/aether/util/version/GenericVersionScheme.html[GenericVersionScheme].
+
Optionally, the 'Repository Target' parameter can be used to narrow
down the content of the repository that is analyzed, to determine if
any deletion should occur. Choosing +All(Maven2)+ is suitable to cause
all maven2-formatted repositories to be analysed. If you want to only
target a specific groupId and artifactId combination or a number of
them you can create a suitable repository target as documented in
<<confignx-sect-managing-repo-targets>> and use it in the
configuration of the scheduled task.
 
Remove Snapshots from Repository:: Often, you will want to remove
snapshots from a snapshot repository to preserve storage space. This
task supports this deletion for time stamped snapshots as created by
Maven 3.x in a deployment repository. Note that configuring and
running this job is not enough to reclaim disk space.  You will also
need to configure a scheduled job to empty the trash folder.  Files
are not deleted by the 'Remove Snapshots' job. They are only moved into
the trash folder.  When you create a scheduled task to remove
snapshots, you can specify the 'Repository/Group' to affect as well as:
+
'Minimum Snapshot Count';; This configuration option allows you to
specify a minimum number of snapshots to preserve per component.  For
example, if you configured this option with a value of 2, Nexus will
always preserve at least two snapshot components. A value of -1
indicates that all snapshots should be preserved.
+
'Snapshot Retention (days)';; This configuration option allows you to
specify the number of days to retain snapshot components.  For example,
if you want to make sure that you are always keeping the last three
day's worth of snapshot components, configure this option with a value
of 3. The minimum count overrides this setting.
+
'Remove if released';; If enabled and a released component with the same
GAV coordinates is detected all snapshots will be removed.
+ 
'Grace period after release (days)';; The configuration 'Remove if
released' causes snapshots to be deleted as soon as the scheduled task
is executed. This can lead to builds that still reference the snapshot
dependency to fail. This grace period parameter allows you to specify
a number of days to delay the deletion, giving the respective projects
referencing the snapshot dependency time to upgrade to the release
component or the next snapshot version.
+
'Delete immediately';; If you want to have components deleted directly
rather than moved to the trash, you can enable this setting.
+
When doing regular deployments to a snapshot repository via a CI
server, this task should be configured to run regularly.
 
Repair Repositories Index:: In certain cases it might be required to
remove the internal index as well as the published ones of a
repository.  This task does that and then rebuilds the internal index
by first trying to download remote indexes (if a proxy repository),
then scanning the local storage and updating the internal index
accordingly. Lastly, the index is published for the repository as
well. There should be no need to schedule this task. But when
upgrading Nexus, the upgrade instructions may sometimes include a
manual step of executing this task.
 
Synchronize Shadow Repository:: This service synchronizes a shadow (or
virtual) repository with its master repository. This task is only
needed when external changes affected a source repository of a virtual
repository you are using.

Update Repositories Index:: If files are deployed directly to a
repository's local storage (not deployed through Nexus), you will need
to instruct Nexus to update its index. When executing this task, Nexus
will update its index by first downloading remote indexes (if a proxy
repository) and then scan the local storage to index the new files.
Lastly, the index is published for the repository as well. Normally,
there should be no need to schedule this task. One possible exception
would be if files are deployed directly to the local storage regularly.
 
Yum: Generate Metadata:: The metadata for a yum repository is created
and maintained by the http://createrepo.baseurl.org/[createrepo]
tool. This scheduled task allows you to run it for a specific
repository and optionally configure the output directory. 
////

Beyond these tasks any plugin can provide additional scheduled tasks,
which will appear once you have installed the plugin.

////
The Evict and Purge actions do not delete data from the Nexus
working directory. They simply move data to be cleared or evicted to a
trash directory under the Nexus work directory. If you want to reclaim
disk space, you need to clear the Trash on the Browse Repositories
screen. If something goes wrong with a evict or clear service, you can
move the data back to the appropriate storage location from the trash.
You can also schedule the Empty Trash service to clear this directory
on a periodic basis.

TIP: In order to keep the heap usage in check it is recommended that
you schedule an "optimize indexes" task to run weekly. A number of
other maintenance tasks should also be scheduled for production
deployments.
////

Setting up tasks execution adapted to your usage of Nexus is an
important first step when setting up a Nexus instance. Go through the
list of task types and consider your usage patterns of Nexus. Also
update your tasks when changing your usage. E.g., if you
start to regularly deploy snapshots by introducing continuous
integration server builds with deployment.

[[admin-repositories]]
=== Repository Management
{in} {oss}, {pro}, {proplus}

Repositories are the containers for the components provided to your
users as explained in more detail in <<concepts>>. Creating and
managing repositories is an essential part of your Nexus
configuration, since it allows you to expose more components to your
users.

Nexus supports proxy repositories, hosted repositories and repository
groups using a number of different repository formats.

To manage Nexus repositories select the 'Repositories' item in the
'Repository' sub menu of the 'Administration' menu.

[[proxy-repository]]
==== Proxy Repository

A repository with the type 'proxy', also known as a proxy repository,
is a repository that is linked to a remote repository. Any request for
a component is verified against the local content of the proxy
repository. If no local component is found, the request is forwarded
to the remote repository. The component is then retrieved and stored
locally in Nexus, which acts as a cache. Subsequent requests for the same
component are then fulfilled from the local storage, therefore
eliminating the network bandwidth and time overhead of retrieving the
component from the remote repository again.

By default, Nexus ships with the following configured proxy
repositories:

maven-central:: This proxy repository accesses the
http://search.maven.org/[Central Repository], formerly known as Maven
Central. It is the default component repository built into Apache
Maven and is well-supported by other build tools like Gradle, SBT or
Ant/Ivy.

nuget.org-proxy:: This proxy repository accesses the
http://www.nuget.org/[NuGet Gallery]. It is the default component
repository used by the `nuget` package management tool used for .Net
development.

[[hosted-repository]]
==== Hosted Repository

A repository with the type 'hosted', also known as a hosted
repository, is a repository that stores components in Nexus as the
authoritative location for these components.

By default, Nexus ships with the following configured hosted
repositories:

maven-releases:: This hosted repository uses the 'maven2' repository
 format with a release version policy. It is intended to be the
 repository where your organization publishes internal releases. You
 can also use this repository for third-party components that are not
 available in external repositories and can therefore not be retrieved
 via a configured proxy repository. Examples of these components could
 be commercial, proprietary libraries such as an Oracle JDBC driver
 that may be referenced by your organization.

maven-snapshots:: This hosted repository uses the 'maven2' repository
 format with a snapshot version policy. It is intended to be the the
 repository where your organization publishes internal development
 versions, also known as snapshots.
 
nuget-hosted:: This hosted repository is where your organization can
publish internal releases in repository using the NuGet repository
format. You can also use this repository for third-party components
that are not available in external repositories, that could
potentially be proxied to gain access to the components.

[[repository-group]]
==== Repository Group

A repository with the type 'group', also known as repository group,
represents a powerful feature of Nexus. They allow you to combine
multiple repositories and other repository groups in a single
repository. This in turn means that your users can rely on a single
URL for their configuration needs, while the Nexus administrators can
add more repositories and therefore components to the repository
group.

Nexus ships with the following groups: 

maven-public:: The 'maven-public' group is a repository group of
'maven2' formatted repositories and combines the important external
proxy repository for the Central Repository with the hosted
repositories 'maven-releases' and 'maven-snapshots'. This allows you
to expose the components of the Central Repository as well as your
internal components in one single, simple-to-use repository and
therefore URL.

nuget-group:: This group combines the nuget formatted repositories
'nuget-hosted' and 'nuget.org-proxy' into a single repository for
your .Net development with NuGet.

[[admin-repository-repositories]]
==== Managing Repositories and Repository Groups

The administration user interface for repositories and repository
groups is available via the 'Repositories' item in the 'Repository'
sub menu of the 'Administration' menu. It allows you to create and
configure repositories as well as delete them and perform various
maintenance operations. The initial view displayed in
<<fig-admin-repository-repositories-list>> features a list of all
configured repositories and repository groups.

[[fig-admin-repository-repositories-list]]
.List of Repositories
image::figs/web/admin-repository-repositories-list.png[scale=50]

The list of repositories displays some information
for each repository in the following columns

Name:: the unique name of the repository or repository group

Type:: the type of the repository with values of 'proxy' or 'hosted'
for repositories or 'group' for a repository group

Format:: the repository format used for the storage in the repository with values
such as 'maven2', 'nuget' or others

Status:: the status of the repository as well as further information
about the status.  A functioning repository would show the status to
be 'Online'. Additional information can e.g., be about SSL
certification problems or the status of the remote repository for
a currently disabled proxy repository

URL:: the direct URL path that exposes the repository via HTTP access
and potentially, depending on the repository format, allows access and
directory browsing

////
Health Check:: the result counts for a repository health check or a
button to start the analysis

TBD as documented in <<rhc>>
////

The 'Create repository' button above the repository list triggers a
dialog to select the 'Recipe' for the new repository. The recipe
combines the format and the type of repository into a single
selection. Depending on your Nexus version and installed plugins, the
list of available choices differs.

For example to create another release repository in 'maven2' format, you
would click on the row with the recipe 'maven2 (hosted)' in the
dialog. If you wanted to proxy a 'maven2' repository, choose
'maven 2 (proxy)'. On the other hand if you want to proxy a nuget
repository, choose 'nuget (proxy)'. With 'maven2 (group)' you can
create a repository group for 'maven2' repositories.

After this selection, you are presented with the configuration view,
that allows you to fill in the required parameters and some further
configuration. The exact details on the view depend on the selected
repository provider and are identical to the administration for
updating the configuration of a repository documented in the following
sections.

Once you have created a repository or repository group, it is
available in the list for further configuration and management.
Clicking on a specific row allows you to navigate to this repository
specific administration section. An example for the 'maven-central'
repository is partially displayed in <<fig-admin-repository-repositories-central>>.

[[fig-admin-repository-repositories-central]]
.Partial Repository Configuration for a Proxy Repository
image::figs/web/admin-repository-repositories-central.png[scale=50]


The 'Delete repository' button allows you to delete this repository and all
related configuration and components, after confirming the operation
in a dialog. 

The following properties can be viewed for all repositories and can
not be edited after the initial creation of the repository.

Name:: The 'Name' is the identifier that will be used in the
Nexus URL. For example, the proxy repository for the Central
Repository has a name of +maven-central+.  The 'Name' must be
unique in a given Nexus installation and is required.

Format:: 'Format' defines in what format Nexus exposes the repository
to external tools. Supported formats depend on the Nexus edition and
the installed plugins. Examples are 'maven2', 'nuget', 'raw' and
others.

Type:: The type of repository - 'proxy', 'hosted' or 'group'. 

URL::  It shows the user facing URL this means that Maven and
other tools can access the repository directly at e.g., 
+http://localhost:8081/repository/maven-central+. 

Online:: The checkbox allows you set whether this repository on Nexus
is available to client side tools or not.

Beyond the generic fields used for any repository, a number of
different fields are used and vary depending on the repository format
and type. They are grouped under a number of specific headers that
include configuration for the related aspects and include:

* Hosted
* Proxy
* Negative Cache 
* HTTP
* Maven 2
* NuGet

===== Hosted

A hosted repository includes configuration of a 'Deployment policy' in
the 'Hosted' configuration section. Its setting controls how a hosted
repository allows or disallows component deployment.

If the policy is set to 'Read-only', no deployment is allowed. 

If this policy is set to 'Disable redeploy', a client can only deploy
a particular component once and any attempt to deploy a component
again will result in an error. The disabled redeploy is the default
value, since most client tools assume components to be immutable and
will not check a repository for changed components that have already
been retrieved and cached locally.

If the policy is set to 'Allow redeploy', clients can deploy
components to this repository and overwrite the same component in
subsequent deployments.


===== Proxy

The configuration for proxy repositories in the 'Proxy' section
contains the following parameters:

Remote Storage:: A proxy repository on the other hand requires the
configuration of the 'Remote Storage'. It needs to be configured with
the URL of the remote repository, that should to be proxied. When
selecting the URL to proxy it is beneficial to avoid proxying remote
repository groups. Proxying repository groups prevents some
performance optimization in terms of accessing and retrieving the
content of the remote repository. If you require components from the
group that are found in different hosted repositories on the remote
repository server it is better to create multiple proxy repositories
that proxy the different hosted repositories from the remote server on
your Nexus server instead of simply proxying the group.

Use the Nexus truststore:: This checkbox allows you to elect for Nexus to manage the SSL certificate of the remote
repository. It is only displayed - if the remote storage uses a HTTPS URL. The 'View certificate' button triggers the
display of the SSL certificate details in a dialog. The dialog allows you to add or remove the certificate from the
certificate truststore maintained by Nexus. Further details are documented in <<ssl-proxy-repo>>.


////
Download Remote Indexes;; Download the index of a remote repository
can be configured with this setting. If enabled, Nexus will download
the index, if it exists, and use that for its searches as well as
serve that up to any clients that ask for the index (like
m2eclipse). The default for new proxy repositories is enabled, but all
of the default repositories included in Nexus have this option
disabled. To change this setting for one of the proxy repositories
that ship with Nexus, change the option, save the repository, and then
re-index the repository. Once this is done, component search will
return every component available on the Maven Central repository.
////

Blocked:: Setting a repository to blocked causes Nexus to no longer
send outbound requests to the remote repository.

Auto blocking enabled:: If 'Auto blocking enabled' is set to true, Nexus
will automatically block a proxy repository if the remote repository
becomes unavailable. While a proxy repository is blocked, components
will still be served to clients from a local cache, but Nexus will not
attempt to locate an component in a remote repository. Nexus will
periodically retest the remote repository and unblock the repository
once it becomes available.

Maximum component age:: When the proxy receives a request for a component, it
does not request a new version from the remote repository until the existing
component is older than 'Maximum component age'.

Maximum metadata age:: Nexus retrieves metadata from the remote repository.
It will only retrieve updates to metadata after the 'Maximum metadata age'
has been exceeded.  If the metadata is component metadata, it uses the longer
of this value and 'Maximum component age' before rechecking.

////
tbd once fixed..
The default for this setting is -1 for a repository with
a release policy and 1440 for a repository with snapshot policy.
////


===== Negative Cache

Not found cache enabled/Not found cache TTL:: If Nexus fails to locate
a component, it will cache this result for a given number of
minutes. In other words, if Nexus can't find a component in a remote
repository, it will not perform repeated attempts to resolve this
component until the 'Not found cache TTL' time has been exceeded. The
default for this setting is 1440 minutes (or 24 hours) and this cache
is enabled by default.

===== HTTP 

The 'HTTP' configuration section allows you to configure the necessary
details to access the remote repository, even if you have to provide
authentication details in order to acces it successfully or if you
have to connect to it via a proxy server.

NOTE: This configuration is only necessary, if it is specific to this
repository. Global HTTP proxy and authentication is documented in
<<admin-system-http>>.

Authentication:: This section allows you to select 'Username' or
'Windows NTLM' as 'authentication type'. Subsequently you can provide
the required 'Username' and 'Password' for plain authentication or
'Username', 'Password', 'Windows NTLM hostname' and 'Windows NTLM
domain' for 'Windows NTLM'-based authentication.

HTTP request settings:: In the 'HTTP Request Settings' you can change
the properties of the HTTP requests to the remote repository. You can
append a string to the user-agent HTTP header in the 'User-agent
customization' of the request and add parameters to the requests in
'URL parameters'. Additionally you can set the timeout value for
requests in seconds in 'Connection timeout' and configure a number of
'Connection retries'. The HTTP requests configured are applied to all
requests made from Nexus to the remote repository being proxied.


////

File Content Validation;; If set to true, Nexus will perform a
lightweight check on the content of downloaded files. This will
prevent invalid content to be stored and proxied by Nexus that
otherwise can happen in cases where the remote repository (or some
proxy between Nexus and the remote repository) returns a HTML page
instead of the requested file.

Checksum policy;; Sets the checksum policy for a remote
repository. This option is set to 'Warn' by
default. The possible values of this setting are:
+
* 'Ignore' - Ignore the checksums entirely
* 'Warn' - Print a warning in the log if a checksum is not correct
+
* 'StrictIfExists' - Refuse to cache an component if the calculated
checksum is inconsistent with a checksum in the repository. Only
perform this check if the checksum file is present.
+
* 'Strict' - Refuse to cache an component if the calculated checksum is
inconsistent or if there is no checksum for an component.


Allow file browsing;; When set to true, users can browse the contents
of the repository with a web browser.

Include in Search;; When set to true, this repository is included when
you perform a search in Nexus. If this setting is false, the contents
of the repository are excluded from a search.

Publish URL;; If this property is set to false, the repository will
not be published on a URL, and you will not be able to access
this repository remotely. You would set this configuration
property to false if you want to prevent clients for
connecting to this repository directly.

Expiration Settings:: Nexus maintains a local cache of components and
metadata, you can configure expiration parameters for a proxy
repository. The expiration settings are:

Item Max Age;; Some items in a repository may be neither an artifact
identified by the Maven GAV coordinates or metadata for such components. This
cache value determines the maximum age for these items before
updates are retrieved. 
////

===== Additional Configuration for Repositories Using the Maven2 Format

Version policy:: A Maven repository can either host release components
or development components. The 'Version policy' allows you to set
'Snapshot' for development components that end up with '-SNAPSHOT' in
the version string. This allows repeated uploads where the actual
number used is composed of a date/timestamp and an enumerator and the
retrieval can still use the '-SNAPSHOT' version string. The version
policy can only be set, when the repository is created and can not be
changed at a later stage. Repository groups can be used to expose a
combination of release and development versions from multiple
repositories.

Strict Content Type Validation:: Maven repositories can be configured
to validate any new components to see if the MIME-type corresponds to
the content of the file by enabling this setting. Any files with a
mismatch are rejected.

===== Additional Configuration for Repositories Using the NuGet Format
	
The NuGet repository format uses http://www.odata.org/[OData] queries
for communication between the client and the repository. These queries
include metadata information about available packages and other data.

When Nexus receives queries from the +nuget+ client, it passes these
queries on to the remote repositories, configured as proxy repository,
if necessary.

To avoid sending identical queries to the remote repository, Nexus
caches the queries and will rely on previously stored metadata if the
same query is received again before the cache expires.

The parameters 'Query cache size' and 'Query cache age' can be used to
configure the size of this cache in terms of how many queries are
cached as well as the rate at which queries expire and are
subsequently re-run.

===== Repository Groups

The creation and configuration for a repository group differs a little
from pure repositories. It allows you to manage the member
repositories of a repository group. An example for a repository group
using the 'maven2' format is visible in <<fig-group-config>>. In this
figure you can see the contents of the 'maven-public' group that is
pre-configured in Nexus.

[[fig-group-config]]
.Repository Group Configuration
image::figs/web/admin-repository-repositories-group.png[scale=50]

The 'Format' and 'Type' are determined by the selection of the
provider in the creation dialog e.g., 'maven2 (group)' for the
'maven-public' as a 'maven2' format repository group.

The 'Name' is set during the creation and is fixed once the repository
group is created.

The 'Online' checkbox allows you set whether this repository group on
Nexus is available to client side tools or not.

The 'Member repositories' selector allows you to add repositories to
the repository group as well as remove them. The 'Members' column
includes all the repositories that constitute the group. The
'Available' column includes all the repositories and repository groups
that can potentially be added to the group.

Note that the order of the repositories listed in the 'Member' section
is important. When Nexus searches for a component in a repository
group, it will return the first match. To reorder a repository in this
list, click and the drag the repositories and groups in the 'Members'
list or use the arrow buttons between the 'Available' and 'Members'
list. These arrows can be used to add and remove repositories as well.

The order of repositories or other groups in a group can be used to
influence the effective metadata that will be retrieved by Maven or
other tools from a Nexus Repository Group. We recommend placing hosted
repositories higher in the list than proxy repositories. For proxy
repositories Nexus needs to check the remote repository
which will incur more overhead than a hosted repository lookup.

We also recommend placing repositories with a higher probability of
matching the majority of components higher in this list. If most of
your components are going to be retrieved from the Central Repository,
putting 'maven-central' higher in this list than a smaller, more focused
repository is going to be better for performance, as Nexus is not
going to interrogate the smaller remote repository for as many missing
components. These best practices are implemented in the default
configuration.

==== Repository Management Example

The following sections detail some common steps of your repository
management efforts on the example of a 'maven2' repository.

[[config-sect-custom]]  
===== Adding Repositories for Missing Dependencies

If you've configured your Maven +settings.xml+ or other build tool
configuration to use the Nexus +maven-public+ repository group as a
mirror for all repositories, you might encounter projects that are
unable to retrieve components from your local Nexus installation.

TIP:: More details about client tool configuration for Maven
repositories can be found in <<config>>.

This usually happens because you are trying to build a project that
has defined a custom set of repositories and snapshot repositories or
relies on the content of other publicly available repositories in
its configuration. When you encounter such a project all you have to
do is 

* add this repository to Nexus as a new 'maven2' format, proxy repository 
* and then add the new proxy repository to the 'maven-public' group.

The advantage of this approach is that no configuration change on the
build tool side is necessary at all.

[[config-sect-new-repo]]
===== Adding a New Repository

Once you have established the URL and format of the remote repository
you are ready to configure Nexus. E.g. the JBoss.org releases
repository contains your missing component. Click on the 'Create
repository' button in the 'Repositories' feature view and click on
'maven2 (proxy)' from the list in the dialog.

In the configuration dialog:

* Set 'Name' to +jboss-releases+
* Set 'Remote storage'  to
  +https://repository.jboss.org/nexus/content/repositories/releases/+
* For a 'maven2' format repository, confirm that the 'Version policy'
  is set correctly to 'Release'.
* Click on the 'Create repository' button at the end of the form

Nexus is now configured to proxy the repository. If the remote
repository contains snapshots as well as release components, you will
need to repeat the process creating a second proxy repository with the
same URL setting version policy to 'Snapshot'.

[[config-sect-repo-group]]  
===== Adding a Repository to a Group

Next you will need to add the new repository 'jboss-releases' to the
'maven-public' repository group. To do this, click on the row of
the 'maven-public' group in the 'Repositories' feature view.

To add the new repository to the public group, find the repository in
the 'Available' list on the left, click on the repository you want to
add and drag it to the right to the 'Members' list. Once the
repository is in that list, you can click and drag the repository
within that list to alter the order in which the group will be
searched for a matching component. Press the 'Save' button to complete
this configuration.

In the last few sections, you learned how to add new repositories to a
build in order to download components that are not available in the
Central Repository.

If you were not using a repository manager, you would have added these
repositories to the repository element of your project's POM, or you
would have asked all of your developers to modify +~/.m2/settings.xml+
to reference two new repositories. Instead, you used the Nexus
repository manager to add the two repositories to the public group. If
all of the developers are configured to point to the public group in
Nexus, you can freely swap in new repositories without asking your
developers to change local configuration, and you've gained a certain
amount of control over which repositories are made available to your
development team. In addition the performance of the component
resolving across multiple repositories will be handled by Nexus and
therefore be much faster than client side resolution done by Maven
each time.

[[admin-support]]
=== Support Features

Nexus provides a number of features that allow you to ensure your
server is configured correctly and provides you with tools to
investigate details about the configuration. This information can be
useful for troubleshooting and support activities.

All support features are available in the 'Support' group of the
'Administration' menu in the main menu section and include:

* <<admin-support-analytics,Analytics>>
* <<admin-support-logging,Logging and Log Viewer>>
* <<admin-support-metrics,Metrics>>
* <<admin-support-supportzip,Support ZIP>>
* <<admin-support-systeminformation,System Information>>


[[admin-support-analytics]]
==== Analytics
{in} {oss}, {pro}, {proplus}

The analytics integration of Nexus allow Sonatype to gather data about
of your Nexus usage, since it enables the collection of event data in
Nexus. It collects non-sensitive information about how you are using
Nexus and allows Sonatype to achieve a better understanding of Nexus
usage overall and therefore drive production innovation following your
needs

The collected information is limited the primary interaction points
between your environment and Nexus. None of the request specific data
(e.g., credentials or otherwise sensitive information) is ever
captured.

TIP: The data is can be useful to you from a compatibility
perspective, since it gathers answers to questions such as what
features are most important, where are users having difficulties, and
what integrations/APIs are actively in use.

You can enable the event logging in the 'Analytics' feature view
available via 'Analytics' menu item in the 'Support' section of the
'Administration' menu. Select the checkbox beside 'Collect analytics
events' and press the 'Save' button.

You can choose to provide this data automatically to Sonatype by
selecting the checkbox beside 'Enable anonymized analytics submission
to Sonatype'. It enables Sonatype to tailor the ongoing development of
the product. Alternatively, you can submit the data manually or just
use the gathered data for your own analysis only.

Once enabled, all events logged can be inspected in the 'Events'
feature view available via the 'Analytics' section of the
'Administration' menu displayed in <<fig-analytics-events>>.

[[fig-analytics-events]]
.List of Analytics Events
image::figs/web/analytics-events.png[scale=50]

The list of events shows the 'Event type', the 'Timestamp', the
'Sequence' number and the 'Duration' of the event as well as the
'User' that triggered it and any 'Attributes'. Each row has a '+'
symbol in the first column that allows you to expand the row
vertically. Each attribute will be expanded into a separate line
allowing you to inspect all the information that is potentially
submitted to Sonatype.

The 'User' value is replaced by a salted hash so that no username
information is transmitted. The 'Anonymization Salt' is automatically
randomly generated by Nexus and can optionally be configured in the
'Analytics: Collection' capability manually. This administration area
can additionally be used to change the random identifier for the Nexus
instance.

TIP: More information about capabilities can be found in <<admin-system-capabilities>>.

If you desire to further inspect the data that is potentially
submitted, you can select to download the file containing the JSON
files in a zip archive by clicking the 'Export' button above the
events list and downloading the file. The 'Submit' button can be used
to manually submit the events to Sonatype.

IMPORTANT: Sonatype values your input greatly and hopes you will
activate the analytics feature and the automatic submission to allow
us to ensure ongoing development is well aligned with your needs. In
addition, we appreciate any further direct contact and feedback in
person and look forward to hearing from you.

[[admin-support-logging]]
==== Logging and Log Viewer
{in} {oss}, {pro}, {proplus}

You can configure the level of logging for Nexus and all plugins as
well as inspect the current log using the Nexus user interface with
the 'Logging' and the 'Log Viewer' feature views. 

Access the 'Logging' feature view displayed in <<fig-logging>> with
the 'Logging' menu item in the 'Support' section in the
'Administration' main menu.

[[fig-logging]]
.The Logging Feature View for Configuring Loggers
image::figs/web/logging.png[scale=60]

The 'Logging' feature view allows you to configure the preconfigured
loggers as well as add and remove loggers. You can modify the log
level for a configured logger by clicking on the 'Level' value e.g.,
+INFO+. It will change into a drop-down of the valid levels including
+OFF+, +DEFAULT+, +INFO+ and others. Press the 'Update' button to
apply the change.

The 'Create logger' button can be used to create new loggers. You will
need to know the 'Logger name' you want to configure. Typically this
corresponds to the Java package name used in the source
code. Depending on your needs you can inspect the source of {oss}
and the plugins as well as the source of your own plugins to determine
the related loggers or contact Sonatype support for detailed help.

If you select a row in the list of loggers, you can delete the
highlighted logger by pressing the 'Delete logger' button above the
list. This only applies to previously created custom loggers. To
disable a default configured logger, set it to `OFF`.

IMPORTANT: When upgrading Nexus, keep in mind that some loggers change
between Nexus versions, so if you rely on specific loggers, you might
have to reconfigure them.

The 'Reset to default levels' button allows you to remove all your
custom loggers and get back to the setup shipped with Nexus.

The loggers configured in the user interface are persisted into
+sonatype-work/nexus/etc/logback-overrides.xml+ and override any
logging levels configured in the main Nexus log file
+logback-nexus.xml+ as well as the other +logback-*+ files. If you
need to edit a logging level in those files, we suggest to edit the
overrides file. This will give you access to edit the configuration in
the user interface at a later stage and also ensure that the values
you configure take precedence.

The 'ROOT' logger level controls how verbose the Nexus logging is in
general. If set to +DEBUG+, Nexus will be very verbose, printing all log
messages including debugging statements. If set to +ERROR+, Nexus will be
far less verbose, only printing out a log statement if Nexus encounters
an error. +INFO+ represents an intermediate amount of logging. 

TIP: When configuring logging, keep in mind that heavy logging can
have a significant performance impact on an application and any
changes trigger the change to the logging immediately.

Once logging is configured as desired, you can inspect the impact of
your configuration in the 'Log Viewer' feature view. It allows you to
copy the log from the server to your machine by pressing the
'Download' button. The 'Create mark' button allows you to add a custom text
string into the log, so that you can create a reference point in the
log file for an analysis of the file. It will insert the text you
entered surrounded by +*+ symbols as visible in
<<fig-log-viewer>>.

[[fig-log-viewer]]
.Viewing the Nexus Log with an Inserted Mark
image::figs/web/log-viewer.png[scale=50]

The 'Refresh interval' configuration on the right on the top of the
view allows you to configure the timing for the refresh as well as the
size of the log displayed. A manual refresh can be triggered with the
general refresh button in the main toolbar.


[[admin-support-metrics]]
==== Metrics
{in} {oss}, {pro}, {proplus}

The 'Metrics' feature view is available in the 'Support' section of
the 'Administration' main menu. It provides insight to characteristics
of the Java virtual machine JVM running Nexus and is displayed in
<<fig-metrics>>.

[[fig-metrics]]
.JVM Metrics
image::figs/web/metrics.png[scale=40]

The 'Memory usage', 'Memory distribution' and 'Thread states' charts
provide some simple visualizations. The 'Download' button allows you
to retrieve a large number of properties from the JVM and download
them in a JSON-formatted text file. Pressing the 'Thread dump' button
triggers the creation of a thread dump of the JVM and a download of
the resulting text file.

////
==== Support Request

tbd

////

[[admin-support-supportzip]]
==== Support ZIP
{in} {oss}, {pro}, {proplus}

The 'Support ZIP' feature view allows you to create a ZIP archive file
that you can submit to Sonatype support via email or a support
ticket. The checkboxes in 'Contents' and 'Options' allow you to
control the content of the archive.

You can include the 'System information report' as available in the
'System Information' tab, a 'JVM thread-dump' of the JVM currently
running Nexus, your Nexus general 'Configuration files' as well as you
'Security configuration files', the Nexus 'Log files' and 'System and
component metrics' with network and request-related information and
'JMX information'.

The 'Options' allow you to limit the size of the included files as
well as the overall ZIP archive file size. Pressing the 'Create
support ZIP' button gathers all files, creates the archive in
`sonatype-work/nexus/downloads/support` and opens a dialog to download
the file to your workstation. This dialog shows the 'Name', 'Size' and
exact 'Path' of the support ZIP file.

[[admin-support-systeminformation]]
==== System Information
{in} {oss}, {pro}, {proplus}

The 'System Information' feature view displays a large number of configuration
details related to 

Nexus:: details about the versions of Nexus and the installed plugins,
Nexus install and work directory location, application host and port
and a number of other properties.

Java Virtual Machine:: all system properties like +java.runtime.name+,
+os.name+ and many more as known by the JVM running Nexus

Operating System:: including environment variables
like +JAVA_HOME+ or +PATH+ as well as details about the runtime in
terms of processor, memory and threads, network connectors and storage
file stores.

You can copy a subsection of the text from the panel or use the
'Download' button to retrieve a JSON-formatted text file.

////

==== PGP Key Server Information

{pro} uses a PGP Key Server to retrieve PGP keys when
validating component signatures. To add a new key server, enter the
URL in the 'Key Server URL' field and click on the 'Add' button. To remove
a key server, click on the URL you wish to remove from the list
and click on the 'Remove' button. Key servers are consulted in the order
that they are listed in the 'Key Server URLs' list. To reorder your key
servers, click and drag a URL in the 'Key Server URLs' list.

[[fig-config-administration-pgp-key-server]]
.Administration PGP Key Server Information
image::figs/web/config-administration-pgp-key-server.png[scale=60]


==== Viewing the Summary Panel for a Repository

The 'Summary' panel can be loaded by selecting a hosted, proxy, or
virtual repository and then clicking on the 'Summary'
tab. The 'Summary' tab of a hosted repository, as shown
in <<fig-configuring-summary-hosted>>, displays the
+distributionManagement+ settings that can be used to configure
Maven to publish components to the hosted repository.

[[fig-configuring-summary-hosted]]
.Repository Summary Panel for a Hosted Repository
image::figs/web/repository-manager_summary-hosted.png[scale=60]

The 'Summary' panel for a proxy repository, as shown in
<<fig-configuring-summary-proxy>>, contains all of the repository
identifiers and configuration as well as a list of groups in which
the repository is contained.

[[fig-configuring-summary-proxy]]
.Repository Summary Panel for a Proxy Repository
image::figs/web/repository-manager_summary-proxy.png[scale=60]

The 'Summary' panel for a virtual repository, as shown in
<<fig-configuring-summary-virtual>>, displays repository identifiers
and configuration as well as the groups in which the repository is
contained.

[[fig-configuring-summary-virtual]]
.Repository Summary Panel for a Virtual Repository
image::figs/web/repository-manager_summary-virtual.png[scale=60]

==== Auto Block/Unblock of Remote Repositories

What happens when Nexus is unable to reach a remote repository? If
you've defined a proxy repository and the remote repository is
unavailable, Nexus will now automatically block the remote repository.
Once a repository has been auto-blocked, Nexus will then periodically
retest the remote repository and unblock the repository once it
becomes available. You can control this behaviour by changing the 'Auto
Blocking Enabled' setting under the 'Remote Repository Access' section
of the proxy repository configuration as shown in the following figure
to 'True':

.Configuring Remote Repository Auto Block/Unblock
image::figs/web/configuring_auto-block.png[scale=75]




[[confignx-sect-managing-routes]]
=== Managing Routing

Routing can be considered the internal activities Nexus performs in
order to determine where to look for a specific component in a
repository. The routing information has an impact on the performance
of component retrieval as well as determining the availability of
components.

A large portion of the performance gains achievable with correct and
optimized routing information is configured by Nexus itself with
automatic routing, documented in <<automatic-routing>>. Fine grained
control and further customizations in terms of access provision can be
achieved with some manual routing configuration documented in
<<manual-routing>>.

[[automatic-routing]]
==== Automatic Routing 

Automatic routing is handled by Nexus on a per repository
basis. You can access the configuration and further details in the
Routing tab after selecting a repository in the list accessible via the
'Repositories' item in the the 'Views/Repositories' left-hand menu.

The routing information consists of the top two levels of the
directory structure of the repository and is stored in a prefixes.txt
file. It allows Nexus to automatically route only component requests
with the corresponding groupId values to a repository, as found in the
text file. This, in turns, avoids unnecessary index or even remote
repository access and therefore greatly improves performance.

Nexus generates the prefixes.txt file for a hosted repository and
makes it available for remote downloads. Each deployment of a new
component will trigger an update of the file for the hosted repository
as well as the prefix files for any repository groups that contain
the hosted repository. You can access it in the 'Routing' tab of a
hosted repository as displayed in <<fig-automatic-routing-hosted>> by
clicking on the 'Show prefix file' link on the right. In addition, the
'Publishing' section shows the 'Status' of the routing information, a
'Message' with further details, and the date and time of the last
update in the 'Published On' field.

[[fig-automatic-routing-hosted]]
.Automatic Routing for a Hosted Repository
image::figs/web/automatic-routing-hosted.png[scale=60]

The 'Routing' tab for a proxy repository displayed in
<<fig-automatic-routing-proxy>> contains the Discovery section. It
displays the 'Status' and a more detailed 'Message' about the prefix
file access. The 'Last run' field displays the date and time of the
last execution of the prefix file discovery. Such an execution can be
triggered by pressing the 'Update now' button. Otherwise, the 'Update
Interval' allows you to trigger a new discovery every one, two, three,
six, nine or twelve hours or as a daily or weekly execution. 

[[fig-automatic-routing-proxy]]
.Automatic Routing for a Proxy Repository
image::figs/web/automatic-routing-proxy.png[scale=60]

For a proxy repository, the prefix file is either downloaded from
the remote repository or a generation is attempted by scraping the
remote repository. This generation is not attempted for remote Nexus
repository groups, since they are too dynamic in nature and should not
be proxied directly. Scraping of hosted or proxy repositories as well
as Subversion-based repositories is supported.

The generation of the prefix file in all the Nexus deployments
proxying each other greatly improves performance for all Nexus
instances. It lowers network traffic and load on the servers, since
failing requests and serving the respective HTTP error pages for a
component that is not found is avoided for each component. Instead,
the regularly light weight download of the prefix file establishes a
good high-level knowledge of components available.

Automatic Routing is configured by Nexus automatically brings
significant performance benefits to all Nexus instances proxying each
other in a network and on the wider internet. It does not need to be
changed apart from tweaking the update interval. To exercise even
finer control than provided by Automatic Routing use Routing as
documented in <<manual-routing>>.

[[manual-routing]]
==== Manual Routing Configuration

Nexus routes are like filters you can apply to groups in terms
of security access and general component retrieval, and can reduce the
number of repositories within a group accessed in order to retrieve an
component. The administration interface for routes can be accessed via
the 'Routing' menu item in the 'View/Repositories' menu in the left-hand
navigation panel.

Routes allow you to configure Nexus to include or exclude specific
repository content paths from a particular component search when Nexus
is trying to locate an component in a repository group. There are a
number of different scenarios in which you might configure a route.

The most commonly configured scenario is when you want to make sure
that you are retrieving components in a particular group ID from a
particular repository. This is especially useful when you want your
own organization's components from the hosted Release and Snapshot
repositories only.

Routes are applicable when you are trying to resolve an component from
a repository group. Using routes allows you to modify the repositories
Nexus will consult when it tries to resolve an component from a group
of repositories.

[[fig-route-config]]
.Routing Configuration Screen in Nexus
image::figs/web/repository-manager_route-config.png[scale=60]

<<fig-route-config>> shows the 'Routing' configuration
screen. Clicking on a route will bring up a screen that will allow
you to configure the properties of a route. The configuration options
available for a route are:

URL Pattern::
    Nexus uses the 'URL Pattern' will use to match a request to
    Nexus. If the regular expression in this pattern is matched, Nexus
    will either include or exclude the listed repositories from a
    particular component query. In <<fig-route-config>>
    the two patterns are:

    +.\*/(com|org)/somecompany/.*+;; This pattern would match all
    paths which includes either +/com/somecompany/+ or
    +/org/somecompany/+. The expression in the parenthesis matches
    either com or org, and the +.*+ matches zero or more
    characters. You would use a route like this to match your own
    organization's components and map these requests to the hosted
    Releases and Snapshots repositories.

    +.\*/org/some-oss/.*+;; This pattern is used in an exclusive
    route. It matches every path that contains +/org/some-oss/+. This
    particular exclusive route excludes the local hosted Releases and
    Snapshots directory for all components that match this path.  When
    Nexus tries to resolve components that match this path, it will
    exclude the Releases and Snapshots repositories.

    Example "(?!/org/some-oss/.*).*";; Using this pattern in an
    exclusive route allows you to exclude everything, except the
    "org/some-oss" project(s).

Rule Type:: Rule Type can be either 'inclusive', 'exclusive' or 'blocking'. An
inclusive rule type defines the set of repositories that should be
searched for components when the URL pattern has been matched. An
exclusive rule type defines repositories which should not be searched
for a particular component. A blocking rule will completely remove
accessibility to the components under the specific pattern in a
specified repository group.

Ordered Route Repositories:: Nexus searches an ordered list of
repositories to locate a particular component.  This order only affects
the order of routes used and not the order of the repositories
searched. That order is set by the order of the repositories in the
group repository's configuration.

In <<fig-route-config>> you can see the two dummy routes that Nexus
has configured as default routes. The first route is an inclusive
route, and it is provided as an example of a custom route an
organization might use to make sure that internally generated
components are resolved from the Releases and Snapshots repositories
only. If your organization's group IDs all start with
+com.somecompany+, and if you deploy internally generated components to
the Releases and Snapshots repositories, this Route will make sure
that Nexus doesn't waste time trying to resolve these components from
public repositories like the Central Repository or the Apache
Snapshots repository.

The second dummy route is an exclusive route. This route excludes the
Releases and Snapshots repositories when the request path contains
+/org/some-oss+. This example might make more sense if we replaced
+some-oss+ with +apache+ or +codehaus+. If the pattern was
+/org/apache+, this rule is telling Nexus to exclude the internal
Releases and Snapshots repositories when it is trying to resolve these
dependencies. In other words, don't bother looking for an Apache
dependency in your organization's internal repositories.

TIP: Exclusive rules will positively impact performance, since the
number of repositories that qualify for locating the component, and
therefore the search effort is reduced.

What if there is a conflict between two routes? Nexus will process
inclusive routes before it will process the exclusive routes.
Remember that routes only affect Nexus' resolution of components when
it is searching a Group. When Nexus starts to resolve an component from
a repository group it will start with the list of repositories in a
group. If there are matching inclusive routes, Nexus will then take
the intersection of the repositories in the group and the repositories
in the inclusive route. The order as defined in the group will not be
affected by the inclusive route. Nexus will then take the result of
applying the inclusive route and apply the exclusive route to that
list of repositories. The resulting list is then searched for a
matching component.

One straightforward use of routes is to create a route that excludes
the Central Repository from all searches for your own organization's
hosted components. If you are deploying your own components to Nexus
under a groupId of +org.mycompany+, and if you are not deploying these
components to a public repository, you can create a rule that tells
Nexus not to interrogate Central for your own organization's
components. This will improve performance because Nexus will not need
to communicate with a remote repository when it serves your own
organization's components. In addition to the performance benefits,
excluding the Central Repository from searches for your own components
will reduce needless queries to the public repositories.

TIP: This practice of defining an inclusive route for your internal
components to only hit internal repositories is a crucial best practice
of implementing a secure component usage in your
organization and a recommended step for initial Nexus
configuration. Without this configuration, requests for internal
components will be broadcasted to all configured external proxy
repositories. This could lead to an information leak, where e.g., your
internet traffic reveals that your organization works on a component
with the component coordinates of
+com.yourcompany.website:new-super-secret-feature:1.0-SNAPSHOT+.


In addition to defining inclusive and exclusive routes, you can define
blocking routes. A blocking route can be created by creating a route
with no repositories in the ordered list of repositories. It allows
you to completely block access to components with the specified
pattern(s) from the group. As such, blocking routes are a simplified,
coarse-grained access control.

TIP: Check out <<procure>> for fine-grained control of artifact
availability and use blocking routes sparingly.


To summarize, there are creative possibilities with routes that the
designers of Nexus may not have anticipated, but we advise you to
proceed with caution if you start relying on conflicting or
overlapping routes.  Use routes sparingly, and use coarse URL
patterns. Remember that routes are only applied to groups and are
not used when an component is requested from a specific repository.


[[nexus-branding]]
=== Customizing the Nexus Application with Branding

The branding plugin is part of {pro} and allows you to
customize your Nexus instance by replacing the default Sonatype Nexus
logo in the top left-hand corner of the header with an image of your
choice.

You can configure it by adding the 'Branding' capability as
documented in <<admin-system-capabilities>> and enabling it. By default, the
branding plugin will look for the new logo in a file called
+branding.png+ in your Nexus data directory's +conf+ folder. By
default, the location is therefore
+sonatype-work/nexus/conf/branding.png+. The new logo needs to be a
PNG image. To blend in well in the UI, it is recommended that it is of
60 pixels height and has a transparent background.

If it fails to find a new logo, the plugin will fall back to using
the default Sonatype Nexus logo.

Prior to Nexus 2.7, the branding plugin was an optional plugin of {pro}
and needed to be installed following the documentation in 
<<install-additional-plugins>>. In this case you needed to add a
branding.image.path property to the 'nexus.properties' file in 
'$NEXUS_HOME/conf/':

----
branding.image.path=/data/images/nexus_logo.png
----

[[nexus-outreach-plugin]]
=== Configuring Outreach Content in Welcome Tab

The Nexus Outreach Plugin is installed and enabled by default in {oss}
and {pro}. It allocates space underneath the
search feature on the 'Welcome' tab for linking to further
documentation and support resources. This data is retrieved from
Sonatype servers.

In a case where this outgoing traffic from your Nexus instance or the
resulting documentation and links are not desired, the plugin can be
disabled. The plugin can be disabled in the settings for the 
'Outreach:Management' capability as documented in <<admin-system-capabilities>>.

You can safely remove the plugin as well without any other negative
side effects. To do so, simply remove the 'nexus-outreach-plugin-X.Y.Z'
folder in '$NEXUS_HOME/nexus/WEB-INF/plugin-repository/' and restart
your Nexus instance.

[[confignx-sect-network]]
=== Network Configuration

By default, Nexus listens on port 8081. You can change this port, by
changing the value in the +$NEXUS_HOME/conf/nexus.properties+ file
shown in <<fig-conf-nexus-properties>>. To change the port, stop
Nexus, change the value of applicationPort in this file, and then
restart Nexus. Once you do this, you should see a log statement in
+$NEXUS_HOME/logs/wrapper.log+ telling you that Nexus is listening on
the altered port.

[[fig-conf-nexus-properties]]
.Contents of conf/nexus.properties
----
# Sonatype Nexus
# ==============
# This is the most basic configuration of Nexus.

# Jetty section
application-port=8081
application-host=0.0.0.0
nexus-webapp=${bundleBasedir}/nexus
nexus-webapp-context-path=/nexus

# Nexus section
nexus-work=${bundleBasedir}/../sonatype-work/nexus
runtime=${bundleBasedir}/nexus/WEB-INF
----


[[confignx-sect-plugins]]
=== Nexus Plugins and the REST API

As documented in <<install-additional-plugins>>, Nexus is built as a
collection of plugins supported by a core architecture and additional
plugins can be installed.

You can use the Nexus Plugin Console to list all installed Nexus
plugins and browse REST services made available by the installed
plugins. To open the Nexus Plugin Console, click on the 'Plugin Console'
link in the 'Administration' menu in the left-hand Nexus menu.

Once you open the Plugin Console, you will see a list of plugins
installed in your Nexus installation. Clicking on a plugin in this
list will display information about the plugin including name,
version, status, a description, SCM information about the plugin, and
the URL of the plugin's project web site and links to the plugin
documentation.

[[fig-config-plugin-console]]
.Plugin Console
image::figs/web/config-plugin-console.png[scale=50]

All the functionality in the Nexus user interface is accessing the
REST API's provided by the different plugins.  An example for the
plugin documentation is the main documentation for the core Nexus API
linked off the Nexus Restlet 1.x Plugin from
<<fig-config-plugin-console>> and displayed in
<<fig-config-plugin-core-api-site>>

[[fig-config-plugin-core-api-site]]
.Documentation Website for the Core REST API
image::figs/web/config-plugin-core-api-site.png[scale=50]

You can use the Nexus REST API to integrate Nexus in your external
systems. 

If your external integration uses Java, or is otherwise JVM based, then 
you can use the Nexus client using the dependency from 
<<fig-client-core-dependency>> with the version corresponding to your 
Nexus server version.


[[fig-client-core-dependency]]
.Nexus Client Core Dependency for Maven Projects
----
<dependency>
    <groupId>org.sonatype.nexus</groupId>
    <artifactId>nexus-client-core</artifactId>
    <version>2.9.0-02</version>
</dependency>
----

Examples of using the client library can be found in the
https://github.com/sonatype/nexus-maven-plugins[Nexus Maven Plugins]
or the https://github.com/sonatype/nexus-ant-tasks[Nexus Ant Tasks].

The REST API can be invoked from many other programming and scripting
languages. A simple example of using the +curl+ command in a shell
script is displayed in <<fig-curl-rest-api-call>>.

[[fig-curl-rest-api-call]]
.A +curl+ Invocation Loading the List of Users from Nexus
----
curl -X GET -u admin:admin123 http://localhost:8081/nexus/service/local/users
----
////

////
/* Local Variables: */
/* ispell-personal-dictionary: "ispell.dict" */
/* End:             */
////




